<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{.Title}}</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-left">
        <div class="logo">üì°</div>
        <div>
          <h1>Goop¬≤ Rendezvous</h1>
          <p class="subtitle">Peer discovery &amp; template distribution for the ephemeral web</p>
        </div>
      </div>
      <div class="header-right">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <span class="theme-icon">üåô</span>
        </button>
        {{if .RegistrationRequired}}<a class="nav-link accent" href="/register">Register</a>{{end}}
        <a class="nav-link" href="/docs">Docs</a>
        {{if .HasAdmin}}<a class="nav-link" href="/admin">Admin</a>{{end}}
        <a class="nav-link" href="/healthz" target="_blank">Health</a>
      </div>
    </header>

    {{if .ConnectURLs}}
    <div class="connect-box glass">
      <div class="connect-label">Connect to this server</div>
      <div class="connect-hint">Paste a URL below into a peer's <strong>WAN rendezvous</strong> setting to join this network</div>
      {{range .ConnectURLs}}
      <div class="connect-url" onclick="navigator.clipboard.writeText('{{.}}').then(()=>{this.classList.add('copied');setTimeout(()=>this.classList.remove('copied'),1200)})">
        <code>{{.}}</code>
        <span class="copy-hint">click to copy</span>
      </div>
      {{end}}
      {{if .RegistrationRequired}}
      <div class="registration-notice">
        <span class="notice-icon">üîê</span>
        <span>This server requires <a href="/register">email registration</a> to be discoverable by other peers.</span>
      </div>
      {{end}}
    </div>
    {{end}}

    {{if .StoreTemplates}}
    <div class="welcome-section">
      <h2 class="section-title">Template Store</h2>
      <p class="templates-hint">Site templates available to peers connected to this rendezvous server.</p>
      <div class="rv-tpl-grid">
        {{range .StoreTemplates}}
        <div class="rv-tpl-card">
          <div class="rv-tpl-icon">{{.Icon}}</div>
          <div class="rv-tpl-body">
            <div class="rv-tpl-name">{{.Name}}</div>
            <div class="rv-tpl-cat">{{.Category}}</div>
            <div class="rv-tpl-desc">{{.Description}}</div>
          </div>
          <div class="rv-tpl-footer">
            <span class="rv-tpl-dir">{{.Dir}}</span>
            <a class="rv-tpl-dl" href="/api/templates/{{.Dir}}/bundle" title="Download bundle">‚¨á bundle</a>
          </div>
        </div>
        {{end}}
      </div>
    </div>
    {{end}}

    <div class="welcome-section">
      <h2 class="section-title">About Goop¬≤</h2>
      <p class="about-text">
        Goop¬≤ is a peer-to-peer content publishing system for the ephemeral web.
        Peers connect via mDNS on local networks or through rendezvous servers like
        this one for WAN discovery. Each peer hosts its own site content and
        synchronizes with others in real time.
      </p>
      <div class="endpoint-chip">{{.Endpoint}}</div>
    </div>

    <script>
      (function(){
        var t = document.getElementById('themeToggle'),
            i = t.querySelector('.theme-icon'),
            h = document.documentElement,
            s = localStorage.getItem('theme') || 'dark';
        h.setAttribute('data-theme', s);
        i.textContent = s === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        t.onclick = function() {
          s = h.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          h.setAttribute('data-theme', s);
          localStorage.setItem('theme', s);
          i.textContent = s === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        };
      })();

      // SPA navigation: fetch public pages without credentials so the
      // browser never re-sends cached Basic-Auth headers (avoids
      // password-manager popups on every click).
      (function(){
        document.addEventListener('click', function(e){
          var a = e.target.closest('a');
          if (!a || a.target === '_blank') return;
          var h = a.getAttribute('href');
          if (!h || h.charAt(0) !== '/') return;
          if (h === '/' || h.indexOf('/docs') === 0) {
            e.preventDefault();
            fetch(h, {credentials:'omit'}).then(function(r){
              if (!r.ok) { location.href = h; return; }
              return r.text();
            }).then(function(t){
              if (!t) return;
              history.pushState(null, '', h);
              document.open(); document.write(t); document.close();
            }).catch(function(){ location.href = h; });
          }
        });
        window.addEventListener('popstate', function(){
          var p = location.pathname;
          if (p === '/' || p.indexOf('/docs') === 0) {
            fetch(p, {credentials:'omit'}).then(function(r){ return r.text(); }).then(function(t){
              document.open(); document.write(t); document.close();
            });
          }
        });
      })();
    </script>
  </div>
</body>
</html>
