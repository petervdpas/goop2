<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{.Title}}</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-right">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <span class="theme-icon">ğŸŒ™</span>
        </button>
        {{if .RegistrationRequired}}<a class="nav-link accent" href="/register">Register</a>{{end}}
        {{if .HasCredits}}<a class="nav-link" href="/credits">ğŸª™ Credits</a>{{end}}
        <a class="nav-link" href="/docs">Docs</a>
        {{if .HasAdmin}}<a class="nav-link" href="/admin">Admin</a>{{end}}
      </div>
    </header>

    <!-- Hero: splash + intro side-by-side -->
    <div class="splash-row">
      <div class="splash-text">
        <h2>Welcome to the Ephemeral Web</h2>
        <p>
          <strong>GoopÂ²</strong> is a peer-to-peer platform for websites, apps, and services that exist
          only while their owner is online. No hosting, no accounts &mdash; just direct
          connections between peers.
        </p>
        <p>
          This is a <strong>rendezvous server</strong> &mdash; a meeting point where peers
          discover each other across the internet. Connect your GoopÂ² peer to this
          server to join the network and browse available site templates.
        </p>
        <div class="hero-features">
          <div class="hero-feature">
            <span class="hero-feature-icon">ğŸ”—</span>
            <span>Direct P2P connections</span>
          </div>
          <div class="hero-feature">
            <span class="hero-feature-icon">ğŸ’¨</span>
            <span>Content vanishes when you leave</span>
          </div>
          <div class="hero-feature">
            <span class="hero-feature-icon">ğŸ§©</span>
            <span>Install &amp; customize templates</span>
          </div>
          <div class="hero-feature">
            <span class="hero-feature-icon">ğŸ”’</span>
            <span>No accounts or tracking</span>
          </div>
        </div>
        <div class="hero-steps">
          <div class="hero-step">
            <span class="hero-step-num">1</span>
            <span>Download &amp; run <a href="https://github.com/petervdpas/goop2" target="_blank">GoopÂ²</a></span>
          </div>
          <div class="hero-step">
            <span class="hero-step-num">2</span>
            <span>Paste the server URL into your WAN rendezvous setting</span>
          </div>
          <div class="hero-step">
            <span class="hero-step-num">3</span>
            <span>Browse templates, build your site, go live</span>
          </div>
        </div>
      </div>
      <div class="splash-side">
        <img class="splash-img" src="/assets/goop2-splash.jpg" alt="GoopÂ²" />
      </div>
    </div>

    {{if .HasStore}}
    <div class="store-promo glass">
      <div class="store-promo-icon">ğŸ§©</div>
      <div class="store-promo-body">
        <h3>Template Store</h3>
        <p>{{.StoreCount}} ready-made sites available â€” chess, kanban, quizzes, and more. Install on your peer with one click.</p>
      </div>
      <a class="store-promo-link" href="/store">Browse Templates â†’</a>
    </div>
    {{end}}

    {{if .HasCredits}}
    <div class="store-promo glass">
      <div class="store-promo-icon">ğŸª™</div>
      <div class="store-promo-body">
        <h3>Credits</h3>
        <p>Purchase credit packs to unlock premium templates.</p>
      </div>
      <a class="store-promo-link" href="/credits">Buy Credits â†’</a>
    </div>
    {{end}}

    {{if .ConnectURLs}}
    <div class="connect-box glass">
      <div class="connect-label">Connect to this server</div>
      <div class="connect-hint">Copy a URL below and paste it into your peer's <strong>WAN rendezvous</strong> setting</div>
      {{range .ConnectURLs}}
      <div class="connect-url" onclick="navigator.clipboard.writeText('{{.}}').then(()=>{this.classList.add('copied');setTimeout(()=>this.classList.remove('copied'),1200)})">
        <code>{{.}}</code>
        <span class="copy-hint">click to copy</span>
      </div>
      {{end}}
      {{if .RegistrationRequired}}
      <div class="registration-notice">
        <span class="notice-icon">ğŸ”</span>
        <span>
          <a href="/register">Register</a> to join the network{{if .HasCredits}} and receive <strong>{{.RegistrationCredits}} free credits</strong> for the template store{{end}}.
        </span>
      </div>
      {{end}}
    </div>
    {{end}}

    <footer class="footer">
      <p>
        GoopÂ² is <a href="https://github.com/petervdpas/goop2" target="_blank">open source</a> &middot;
        GPLv2 License
      </p>
      <div class="endpoint-chip">{{.Endpoint}}</div>
    </footer>

    <script>
      (function(){
        var t = document.getElementById('themeToggle'),
            i = t.querySelector('.theme-icon'),
            h = document.documentElement,
            s = localStorage.getItem('theme') || 'dark';
        h.setAttribute('data-theme', s);
        i.textContent = s === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        t.onclick = function() {
          s = h.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          h.setAttribute('data-theme', s);
          localStorage.setItem('theme', s);
          i.textContent = s === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        };
      })();

      // SPA navigation: fetch public pages without credentials so the
      // browser never re-sends cached Basic-Auth headers (avoids
      // password-manager popups on every click).
      (function(){
        document.addEventListener('click', function(e){
          var a = e.target.closest('a');
          if (!a || a.target === '_blank') return;
          var h = a.getAttribute('href');
          if (!h || h.charAt(0) !== '/') return;
          if (h === '/' || h.indexOf('/docs') === 0) {
            e.preventDefault();
            fetch(h, {credentials:'omit'}).then(function(r){
              if (!r.ok) { location.href = h; return; }
              return r.text();
            }).then(function(t){
              if (!t) return;
              history.pushState(null, '', h);
              document.open(); document.write(t); document.close();
            }).catch(function(){ location.href = h; });
          }
        });
        window.addEventListener('popstate', function(){
          var p = location.pathname;
          if (p === '/' || p.indexOf('/docs') === 0) {
            fetch(p, {credentials:'omit'}).then(function(r){ return r.text(); }).then(function(t){
              document.open(); document.write(t); document.close();
            });
          }
        });
      })();
    </script>
  </div>
</body>
</html>
