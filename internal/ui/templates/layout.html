<!-- internal/ui/templates/layout.html -->
{{define "layout"}}
<!DOCTYPE html>
<html data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{.Title}}</title>

    <script>
      (function () {
        try {
          var qp = new URLSearchParams(location.search);
          var t = qp.get("theme");
          if (t !== "light" && t !== "dark") {
            t = localStorage.getItem("goop.theme");
          }
          if (t !== "light" && t !== "dark") t = "dark";
          document.documentElement.setAttribute("data-theme", t);
          try { localStorage.setItem("goop.theme", t); } catch (e) {}
        } catch (e) {}
      })();
    </script>

    <link rel="stylesheet" href="/assets/vendor/codemirror/codemirror.css" />
    <link rel="stylesheet" href="/assets/vendor/codemirror/theme/xq-dark.css" />
    <link rel="stylesheet" href="/assets/vendor/codemirror/theme/xq-light.css" />

    <script defer src="/assets/vendor/codemirror/codemirror.js"></script>
    <script defer src="/assets/vendor/codemirror/mode/xml.js"></script>
    <script defer src="/assets/vendor/codemirror/mode/javascript.js"></script>
    <script defer src="/assets/vendor/codemirror/mode/css.js"></script>
    <script defer src="/assets/vendor/codemirror/mode/htmlmixed.js"></script>

    <link rel="stylesheet" href="/assets/app.css" />
    <script defer src="/assets/app.js"></script>
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <span class="logo">Goop</span>
          <span class="tag">ephemeral web</span>
        </div>

        {{/* Viewer-only chrome: nav + self info */}}
        {{if .SelfID}}
          <nav class="topnav">
            <a class="navitem {{if isActive .Active "peers"}}active{{end}}" href="{{.BaseURL}}/peers">Peers</a>
            <a class="navitem {{if isActive .Active "self"}}active{{end}}" href="{{.BaseURL}}/self">Me</a>
            <a class="navitem {{if isActive .Active "editor"}}active{{end}}" href="{{.BaseURL}}/edit">Editor</a>
            <a class="navitem {{if isActive .Active "logs"}}active{{end}}" href="{{.BaseURL}}/logs">Logs</a>
          </nav>

          <div class="topright">
            <div class="theme">
              <span class="theme-label small muted">Theme</span>
              <label class="switch" title="Toggle light/dark">
                <input id="themeToggle" type="checkbox" aria-label="Toggle theme" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="me">
              <span class="me-label">{{.SelfName}}</span>
              <span class="me-id"><code>{{.SelfID}}</code></span>
            </div>
          </div>
        {{else}}
          {{/* Launcher-only chrome: just theme toggle (optional) */}}
          <div class="topright">
            <div class="theme">
              <span class="theme-label small muted">Theme</span>
              <label class="switch" title="Toggle light/dark">
                <input id="themeToggle" type="checkbox" aria-label="Toggle theme" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        {{end}}
      </header>

      <main class="main">
        <div class="content">{{ include .ContentTmpl . }}</div>
      </main>

      <footer class="footer">
        <div class="footer-inner">
          <span class="muted small">Goop</span>
          <span class="muted small">Â·</span>
          <span class="muted small">ephemeral web</span>
        </div>
      </footer>
    </div>
  </body>
</html>
{{end}}
