<!-- internal/ui/templates/editor.html -->
{{define "page.editor"}}
<div class="page page-editor">
  <div class="create-tabs">
    <a class="create-tab active" href="/edit">Editor</a>
    <a class="create-tab" href="/templates">Templates</a>
  </div>

  {{if .Error}}
    <div class="banner err">{{.Error}}</div>
  {{end}}

  {{if .Saved}}
    <div class="banner ok">Saved.</div>
  {{end}}

  <div class="ed">
    <aside class="ed-left panel">
      <div class="ed-left-head">
        <div class="ed-left-head-row">
          <div>
            <div class="ed-left-title">Site tree</div>
            <div class="muted small">
              <!-- Click to target root -->
              <a href="#" id="ed-root-link" class="muted small" title="Target root (site/)">
                <code>site/</code>
              </a>
            </div>
          </div>

          <!-- Always-visible action: creates in selected folder (defaults to root) -->
          <button type="button" id="ed-new-btn" class="ed-left-newbtn" title="Create in selected folder">
            New‚Ä¶
          </button>
        </div>

        <!-- Make the creation target obvious -->
        <div class="muted small" style="margin-top:8px;">
          Target: <code id="ed-selected-dir-label"></code>
        </div>
      </div>

      <div class="ed-treewrap">
        <div
          id="ed"
          data-csrf="{{.CSRF}}"
          data-open-path="{{.Path}}"
          data-selected-dir="{{.Dir}}"
          data-etag="{{.ETag}}"
        >
          <ul id="ed-tree" class="ed-tree">
            {{range .Tree}}
              <li
                class="ed-tree-item depth-{{.Depth}} {{if .IsDir}}is-dir{{else}}is-file{{end}}"
                data-path="{{.Path}}"
                data-type="{{if .IsDir}}dir{{else}}file{{end}}"
                role="button"
                tabindex="0"
              >
                <span class="ed-tree-icon">{{if .IsDir}}üìÅ{{else}}üìÑ{{end}}</span>
                <span class="ed-tree-label"></span>
              </li>
            {{end}}
          </ul>
        </div>
      </div>

      <div class="ed-left-foot">
        <div class="muted small">
          Right click a folder/file for actions.
        </div>
      </div>

      <div id="ed-menu" class="ed-menu hidden">
        <button type="button" data-action="new-folder" data-show="any">New folder‚Ä¶</button>
        <button type="button" data-action="new-file" data-show="any">New file‚Ä¶</button>
        <hr>
        <button type="button" data-action="open" data-show="file">Open</button>
        <button type="button" data-action="rename" data-show="any">Rename / Move‚Ä¶</button>
        <button type="button" data-action="delete" data-show="any">Delete‚Ä¶</button>
      </div>
    </aside>

    <section class="ed-right panel">
      <div class="ed-fileops">
        <form method="POST" action="/edit/save" class="ed-save">
          <input type="hidden" name="csrf" value="{{.CSRF}}">
          <input type="hidden" name="path" value="{{.Path}}">
          <input type="hidden" name="if_match" value="{{.ETag}}">

          <div class="ed-savebar ed-savebar-compact">
            <div class="ed-savebar-row">
              <div class="ed-savebar-title">
                Edit file: <code>{{.Path}}</code>
              </div>

              <button type="submit" class="ed-savebar-save">Save</button>
            </div>

            <div class="ed-savebar-row ed-savebar-row2">
              <div class="ed-savebar-etag">
                ETag: <code>{{.ETag}}</code>
              </div>
            </div>
          </div>

          <div class="ed-editorwrap">
            <textarea class="ed-area" name="content">{{.Content}}</textarea>
          </div>
        </form>
      </div>
    </section>
  </div>
</div>
{{end}}
