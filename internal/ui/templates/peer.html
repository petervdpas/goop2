{{define "page.peer"}}
<div class="peer-page" data-peer-id="{{.PeerID}}">
<p>
  <a class="back" href="/peers">&larr; back</a>
</p>

<div class="card peer-detail-card">
  <img class="avatar avatar-lg"
       src="/api/avatar/peer/{{.PeerID}}{{if .AvatarHash}}?v={{.AvatarHash}}{{end}}"
       alt="">
  <div class="peer-detail-info">
    <div class="peer-detail-name" id="peer-name">
      <span class="loading-text">Loading...</span>
    </div>
    <div class="muted small">
      {{if .PeerEmail}}{{.PeerEmail}} &middot; {{end}}<code class="copy-hint-inline" onclick="Goop.core.copyToClipboard('{{.PeerID}}', event.target.closest('code'))" title="Click to copy Peer ID" style="cursor:pointer">{{.PeerID}}</code>
    </div>
  </div>
  <a class="btn identity-site-btn"
     href="{{printf "%s/p/%s/" .BaseURL .PeerID}}"
     onclick="return openSite('{{.PeerID}}', document.getElementById('peer-name') ? document.getElementById('peer-name').textContent.trim() : '{{.PeerID}}')"
     rel="noopener">Open site</a>
</div>

{{if not .Reachable}}
<div class="peer-unreachable-banner">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
  </svg>
  Peer unreachable
</div>
{{end}}

<div class="chat-header">
  <h2 style="margin:0;">Chat</h2>
  <div class="chat-call-actions"
       data-peer-video-disabled="{{.VideoDisabled}}"
       data-self-video-disabled="{{.SelfVideoDisabled}}"></div>
</div>
<div class="chat-container">
  <div class="chat-messages" id="chat-messages">
    <p class="muted"><i>Loading messages...</i></p>
  </div>
  {{if .LuaEnabled}}
  <div class="chat-lua-hint">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    Messages starting with <code>!</code> are processed as Lua commands by the remote peer
  </div>
  {{end}}
  <form class="chat-input" id="chat-form">
    <input type="text" id="chat-message" placeholder="{{if not .Reachable}}Peer unreachable{{else}}Type a message...{{end}}" autocomplete="off" required {{if not .Reachable}}disabled{{end}}>
    <button type="submit" {{if not .Reachable}}disabled{{end}}>Send</button>
  </form>
</div>
</div>
{{end}}
