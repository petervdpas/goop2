{{define "page.peer"}}
<div class="peer-page" data-peer-id="{{.PeerID}}">
<p>
  <a class="back" href="/peers">&larr; back</a>
</p>

<div class="card peer-detail-card">
  <img class="avatar avatar-lg"
       src="/api/avatar/peer/{{.PeerID}}{{if .AvatarHash}}?v={{.AvatarHash}}{{end}}"
       alt="">
  <div class="peer-detail-info">
    <div class="peer-detail-name" id="peer-name">
      <span class="loading-text">Loading...</span>
    </div>
    <div class="muted small">
      {{if .PeerEmail}}{{.PeerEmail}} &middot; {{end}}<code>{{.PeerID}}</code>
    </div>
  </div>
  <a class="btn identity-site-btn"
     href="{{printf "%s/p/%s/" .BaseURL .PeerID}}"
     onclick="return openSite('{{.PeerID}}', document.getElementById('peer-name') ? document.getElementById('peer-name').textContent.trim() : '{{.PeerID}}')"
     rel="noopener">Open site</a>
</div>

{{if not .Reachable}}
<div class="peer-unreachable-banner">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
  </svg>
  Peer unreachable
</div>
{{end}}

<div class="chat-header">
  <h2 style="margin:0;">Chat</h2>
  <div class="chat-call-actions">
    {{if or .VideoDisabled .SelfVideoDisabled}}
    <span class="peer-video-disabled" title="Video/audio calls disabled" style="display:flex;align-items:center;gap:4px;color:#f39c12;font-size:12px;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
      Calls disabled
    </span>
    {{else}}
    <button class="call-btn" id="btn-audio-call" title="Voice call">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.8.3 1.58.52 2.34a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.76.22 1.54.4 2.34.52A2 2 0 0 1 22 16.92z"/>
      </svg>
    </button>
    <button class="call-btn" id="btn-video-call" title="Video call">
      <svg width="20" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="23 7 16 12 23 17 23 7"/>
        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
      </svg>
    </button>
    {{end}}
  </div>
</div>
<div class="chat-container">
  <div class="chat-messages" id="chat-messages">
    <p class="muted"><i>Loading messages...</i></p>
  </div>
  {{if .LuaEnabled}}
  <div class="chat-lua-hint">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    Messages starting with <code>!</code> are processed as Lua commands by the remote peer
  </div>
  {{end}}
  <form class="chat-input" id="chat-form">
    <input type="text" id="chat-message" placeholder="{{if not .Reachable}}Peer unreachable{{else}}Type a message...{{end}}" autocomplete="off" required {{if not .Reachable}}disabled{{end}}>
    <button type="submit" {{if not .Reachable}}disabled{{end}}>Send</button>
  </form>
</div>
</div>
{{end}}
