{{define "page.peers"}}
<div class="peers-page" data-self-id="{{.SelfID}}" data-self-name="{{.SelfName}}" data-self-video-disabled="{{.SelfVideoDisabled}}" data-hide-unverified="{{.HideUnverified}}" data-base-url="{{.BaseURL}}">
  <div class="peers-panel">
    <div class="peers-section">
      <h1>Peers <span class="peer-count muted" id="peer-count">({{len .Peers}})</span></h1>

      <input type="text" id="peer-search" class="peer-search" placeholder="Search peers..." autocomplete="off">

      <div id="peers-list" class="peers-list-scroll">
      {{if not .Peers}}
        <p class="muted"><i>No peers yet</i></p>
      {{else}}
      <ul class="peers">
        {{range .Peers}}
        <li class="peerrow" data-peer-id="{{.ID}}">
          <img class="avatar avatar-md" src="/api/avatar/peer/{{.ID}}" alt="">
          <div class="peerleft">
            <div class="peer-name-row">
              <a class="peerid" href="/peer/{{.ID}}">
                <span class="peer-badge" data-unread-badge="{{.ID}}" style="display:none;">‚óè</span>
                {{if .Content}}{{.Content}}{{else}}{{shortID .ID}}{{end}}
              </a>
              {{if not .Verified}}<span class="badge-unverified">unverified</span>{{end}}
              {{if .Email}}<span class="peeremail muted small">{{.Email}}</span>{{end}}
            </div>
            <span class="peercontent muted small"><code>{{shortID .ID}}</code> &middot; seen {{rfc3339 .LastSeen}}</span>
          </div>
          <div class="peerright">
            {{if or .VideoDisabled $.SelfVideoDisabled}}
            <span class="peer-video-disabled" title="Video/audio calls disabled">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:#f39c12;">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
            </span>
            {{else}}
            <button class="peer-call-btn" data-call-audio="{{.ID}}" title="Voice call">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.8.3 1.58.52 2.34a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.76.22 1.54.4 2.34.52A2 2 0 0 1 22 16.92z"/>
              </svg>
            </button>
            <button class="peer-call-btn" data-call-video="{{.ID}}" title="Video call">
              <svg width="16" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="23 7 16 12 23 17 23 7"/>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
              </svg>
            </button>
            {{end}}
            <a class="btn"
               href="{{printf "%s/p/%s/" $.BaseURL .ID}}"
               onclick="return openExternal(this.href)"
               rel="noopener">
              Open Site
            </a>
          </div>
          {{if .ActiveTemplate}}<span class="peer-template-badge">template: {{.ActiveTemplate}}</span>{{end}}
        </li>
        {{end}}
      </ul>
      {{end}}
      </div>
    </div>

    <div class="broadcast-section">
      <h2>üì¢ Broadcast Chat</h2>
      <p class="muted small">Messages sent here are visible to all connected peers</p>

      <div class="chat-container">
        <div class="chat-messages" id="broadcast-messages">
          <p class="muted"><i>Loading messages...</i></p>
        </div>
        <form class="chat-input" id="broadcast-form">
          <input type="text" id="broadcast-input" placeholder="Broadcast to all peers..." autocomplete="off" required>
          <button type="submit">Send</button>
        </form>
      </div>
    </div>
  </div>

  <div class="peers-splash">
    <img src="/assets/images/goop2-splash.png" alt="Goop¬≤">
  </div>
</div>
{{end}}
