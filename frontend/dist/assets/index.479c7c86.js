(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))h(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const W="/assets/goop2-splash.8bd7ac35.png",J="/assets/goop2-icon.a8b5145f.png";function q(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Q(e,t){const a=document.createElement(e);return t&&(a.className=t),a}function o(e){return Q("div",e)}function E(e,t){const a=document.createElement("button");return a.type="button",a.className=t?`btn ${t}`:"btn",a.textContent=e,a}function X(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function Y(e){const t=o("h1");return t.textContent=e,t}function G(e){const t=o("p");return t.textContent=e,t}function k(e){return e==="light"||e==="dark"?e:"dark"}function j(e){try{e=k(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function Z(e){return String(e||"").replace(/\/+$/,"")}async function ee(){try{const e=await window.go.main.App.GetTheme();return k(e)}catch{return"dark"}}async function te(e){e=k(e),j(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function ne(){const e=document.getElementById("themeToggle");if(!e)return;const t=await ee();j(t),e.checked=t==="light",e.addEventListener("change",async()=>{const a=e.checked?"light":"dark";await te(a)})}async function K(e,t){const a=Z(e);if(!a)throw new Error("viewerURL is empty");const h=t&&String(t).startsWith("/")?t:"/peers",r=k(document.documentElement.getAttribute("data-theme"));let i="";try{i=await window.go.main.App.GetBridgeURL()}catch{i=""}const c=new URL(a+h);c.searchParams.set("theme",r),i&&c.searchParams.set("bridge",i),window.location.replace(c.toString())}function M(e,t){return e.find(a=>a.name===t)}function V(e,t){return e.some(a=>a.name===t)}async function oe(e){q(e),e.classList.add("launcher-host");const t=o("launcher"),a=o("launcher-splash"),h=document.createElement("img");h.src=W,h.alt="Goop\xB2",a.appendChild(h),t.appendChild(a);const r=o("launcher-panel"),i=o("top");i.appendChild(Y("Goop\xB2 - Launcher")),i.appendChild(G("Pick a peer, or create a new one.")),r.appendChild(i);const c=o("card"),I=o("cardHead");I.appendChild(G("Create new peer")),c.appendChild(I);const A=o("cardBody"),P=o("row"),R=X("Name your peer (no spaces or special characters)"),y=E("Create","secondary");P.appendChild(R),P.appendChild(y),A.appendChild(P);let T="";const B=o("row folderRow"),D=E("Browse\u2026","secondary"),b=o("folderLabel");b.textContent="Site folder: default (peers/<name>/site)",B.appendChild(D),B.appendChild(b),A.appendChild(B),D.addEventListener("click",async()=>{try{const n=await window.go.main.App.SelectSiteFolder();n&&(T=n,b.textContent=n,b.title=n)}catch{}}),c.appendChild(A),r.appendChild(c);const L=o("card peersCard"),O=o("cardHead");O.appendChild(G("Peers")),L.appendChild(O);const F=o("cardBody"),S=o("tileList");F.appendChild(S),L.appendChild(F);const x=o("cardFoot"),l=E("Start","primary");l.disabled=!0;const C=E("Delete","danger");C.disabled=!0;const p=o("status"),m=o("error");x.appendChild(l),x.appendChild(C),x.appendChild(p),x.appendChild(m),L.appendChild(x),r.appendChild(L),t.appendChild(r),e.appendChild(t);let u=await window.go.main.App.ListPeers(),d="";function w(n){if(d=n,l.disabled=!d,C.disabled=!d,m.textContent="",d){const s=M(u,d);s&&s.rendezvous_only?(l.textContent="Configure",p.textContent=`Selected: ${d} (rendezvous)`):(l.textContent="Start",p.textContent=`Selected: ${d}`)}else l.textContent="Start",p.textContent=""}function N(){if(q(S),!u||u.length===0){const n=o("empty");n.textContent="No peers found.",S.appendChild(n),w("");return}for(const n of u){const s=o("tile"),f=o("tileLeft"),g=document.createElement("input");g.type="radio",g.name="peer",g.checked=n.name===d,g.addEventListener("change",()=>w(n.name));const U=o("tileMeta"),z=o("tileNameRow"),$=document.createElement("span");if($.className="tileName",$.textContent=n.name,z.appendChild($),n.rendezvous_only){const v=document.createElement("span");v.className="rv-badge",v.textContent="Rendezvous",z.appendChild(v)}const _=o("tilePath");_.textContent=`./peers/${n.name}/goop.json`,U.appendChild(z),U.appendChild(_),f.appendChild(g),f.appendChild(U),s.addEventListener("click",v=>{v.target!==g&&(g.checked=!0,w(n.name))}),s.appendChild(f),S.appendChild(s)}}async function H(n){u=await window.go.main.App.ListPeers(),n&&V(u,n)?w(n):V(u,d)||w(""),N()}l.addEventListener("click",async()=>{if(!d)return;const n=M(u,d),s=n&&n.rendezvous_only;l.disabled=!0,C.disabled=!0,m.textContent="",p.textContent=s?"Configuring\u2026":"Starting\u2026";try{await window.go.main.App.StartPeer(d);const f=await window.go.main.App.GetStatus();if(!f||!f.viewerURL)throw new Error("Started but viewerURL missing from status.");await K(f.viewerURL,s?"/self":"/peers")}catch(f){m.textContent=String(f),p.textContent="",l.disabled=!1,C.disabled=!1}}),C.addEventListener("click",async()=>{if(!(!d||!window.confirm(`Delete peer "${d}"?

This will remove ./peers/${d}/`))){m.textContent="",p.textContent="Deleting\u2026",l.disabled=!0,C.disabled=!0;try{await window.go.main.App.DeletePeer(d),await H(""),p.textContent="Deleted."}catch(s){m.textContent=String(s),p.textContent=""}finally{l.disabled=!d,C.disabled=!d}}}),y.addEventListener("click",async()=>{m.textContent="",p.textContent="";const n=R.value.trim();if(!n){m.textContent="Enter a peer name.";return}if(/\s/.test(n)){m.textContent="Peer name must not contain spaces.";return}y.disabled=!0,y.textContent="Creating\u2026";try{const s=await window.go.main.App.CreatePeer(n,T);R.value="",T="",b.textContent="Site folder: default (peers/<name>/site)",await H(s),p.textContent=`Created: ${s}`}catch(s){m.textContent=String(s)}finally{y.disabled=!1,y.textContent="Create"}}),N(),w(""),u&&u.length>0&&(w(u[0].name),N())}async function ae(){const e=document.querySelector(".brand-icon");e&&(e.src=J),await ne();const t=await window.go.main.App.GetStatus();if(t&&t.started==="true"&&t.viewerURL){const h=t.rendezvousOnly==="true"?"/self":"/peers";await K(t.viewerURL,h);return}const a=document.getElementById("content")||document.getElementById("app");!a||await oe(a)}ae();
