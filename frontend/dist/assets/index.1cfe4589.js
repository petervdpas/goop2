(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const p of s.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();const Y="/assets/goop2-splash.8bd7ac35.png",U="/assets/goop2-splash2.a0bd093f.png",Z="/assets/goop2-splash3.68442960.png",ee="/assets/goop2-icon.a8b5145f.png";function V(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function te(e,t){const r=document.createElement(e);return t&&(r.className=t),r}function o(e){return te("div",e)}function N(e,t){const r=document.createElement("button");return r.type="button",r.className=t?`btn ${t}`:"btn",r.textContent=e,r}function ne(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function oe(e){const t=o("h1");return t.textContent=e,t}function D(e){const t=o("p");return t.textContent=e,t}function B(e){return e==="light"||e==="dark"?e:"dark"}function J(e){try{e=B(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function re(e){return String(e||"").replace(/\/+$/,"")}const W={"goop2-splash.png":Y,"goop2-splash2.png":U,"goop2-splash3.png":Z};async function ae(){try{const e=await window.go.main.App.GetTheme();return B(e)}catch{return"dark"}}async function se(e){e=B(e),J(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function ie(){const e=document.getElementById("themeToggle");if(!e)return;const t=await ae();J(t),e.checked=t==="light",e.addEventListener("change",async()=>{const r=e.checked?"light":"dark";await se(r)})}async function Q(e,t){const r=re(e);if(!r)throw new Error("viewerURL is empty");const c=t&&String(t).startsWith("/")?t:"/peers",a=B(document.documentElement.getAttribute("data-theme"));let s="";try{s=await window.go.main.App.GetBridgeURL()}catch{s=""}const p=new URL(r+c);p.searchParams.set("theme",a),s&&p.searchParams.set("bridge",s),window.location.replace(p.toString())}function j(e,t){if(!(!e||!Array.isArray(e)))return e.find(r=>r.name===t)}function K(e,t){return!e||!Array.isArray(e)?!1:e.some(r=>r.name===t)}async function de(e){V(e),e.classList.add("launcher-host");const t=o("launcher"),r=o("launcher-splash"),c=document.createElement("img");c.src=U,c.alt="Goop\xB2",r.appendChild(c),t.appendChild(r);const a=o("launcher-panel"),s=o("top");s.appendChild(oe("Goop\xB2 - Launcher")),s.appendChild(D("Pick a peer, or create a new one.")),a.appendChild(s);const p=o("card"),F=o("cardHead");F.appendChild(D("Create new peer")),p.appendChild(F);const T=o("cardBody"),z=o("row"),I=ne("Name your peer (no spaces or special characters)"),x=N("Create","secondary");z.appendChild(I),z.appendChild(x),T.appendChild(z);let $="";const O=o("row folderRow"),H=N("Browse\u2026","secondary"),S=o("folderLabel");S.textContent="Site folder: default (peers/<name>/site)",O.appendChild(H),O.appendChild(S),T.appendChild(O),H.addEventListener("click",async()=>{try{const n=await window.go.main.App.SelectSiteFolder();n&&($=n,S.textContent=n,S.title=n)}catch{}}),p.appendChild(T),a.appendChild(p);const k=o("card peersCard"),M=o("cardHead");M.appendChild(D("Peers")),k.appendChild(M);const q=o("cardBody"),P=o("tileList");q.appendChild(P),k.appendChild(q);const A=o("cardFoot"),u=N("Start","primary");u.disabled=!0;const g=N("Delete","danger");g.disabled=!0;const h=o("status"),m=o("error");A.appendChild(u),A.appendChild(g),A.appendChild(h),A.appendChild(m),k.appendChild(A),a.appendChild(k),t.appendChild(a),e.appendChild(t);let f=await window.go.main.App.ListPeers(),d="";function b(n){if(d=n,u.disabled=!d,g.disabled=!d,m.textContent="",d){const i=j(f,d);i&&i.rendezvous_only?(u.textContent="Configure",h.textContent=`Selected: ${d} (rendezvous)`):(u.textContent="Start",h.textContent=`Selected: ${d}`),i&&i.splash&&W[i.splash]?c.src=W[i.splash]:c.src=U}else u.textContent="Start",h.textContent="",c.src=U}function G(){if(V(P),!f||f.length===0){const n=o("empty");n.textContent="No peers found.",P.appendChild(n),b("");return}for(const n of f){const i=o("tile"),v=o("tileLeft"),l=document.createElement("input");l.type="radio",l.name="peer",l.checked=n.name===d,l.addEventListener("change",()=>b(n.name));const L=o("tileMeta"),E=o("tileNameRow"),w=document.createElement("span");if(w.className="tileName",w.textContent=n.name,E.appendChild(w),n.rendezvous_only){const y=document.createElement("span");y.className="rv-badge",y.textContent="Rendezvous",E.appendChild(y)}const R=o("tilePath");R.textContent=`./peers/${n.name}/goop.json`,L.appendChild(E),L.appendChild(R),v.appendChild(l),v.appendChild(L),i.addEventListener("click",y=>{y.target!==l&&(l.checked=!0,b(n.name))}),i.appendChild(v),P.appendChild(i)}}async function _(n){f=await window.go.main.App.ListPeers(),n&&K(f,n)?b(n):K(f,d)||b(""),G()}u.addEventListener("click",async()=>{if(!d)return;const n=j(f,d),i=n&&n.rendezvous_only;u.disabled=!0,g.disabled=!0,m.textContent="",h.textContent=i?"Configuring\u2026":"Starting\u2026";const v=document.querySelector(".footer-inner"),l=o("progress-wrap"),L=o("progress-bar"),E=o("progress-fill");L.appendChild(E);const w=document.createElement("span");w.className="progress-label",w.textContent="Initializing\u2026",l.appendChild(L),l.appendChild(w),v&&v.appendChild(l);const R=C=>{if(!C)return;const X=Math.round(C.step/C.total*100);E.style.width=X+"%",w.textContent=C.label||""};window.runtime&&window.runtime.EventsOn("startup:progress",R);const y=()=>{window.runtime&&window.runtime.EventsOff("startup:progress"),l.parentNode&&l.remove()};try{await window.go.main.App.StartPeer(d);const C=await window.go.main.App.GetStatus();if(!C||!C.viewerURL)throw new Error("Started but viewerURL missing from status.");y(),await Q(C.viewerURL,i?"/self":"/peers")}catch(C){y(),m.textContent=String(C),h.textContent="",u.disabled=!1,g.disabled=!1}}),g.addEventListener("click",async()=>{if(!(!d||!window.confirm(`Delete peer "${d}"?

This will remove ./peers/${d}/`))){m.textContent="",h.textContent="Deleting\u2026",u.disabled=!0,g.disabled=!0;try{await window.go.main.App.DeletePeer(d),await _(""),h.textContent="Deleted."}catch(i){m.textContent=String(i),h.textContent=""}finally{u.disabled=!d,g.disabled=!d}}}),x.addEventListener("click",async()=>{m.textContent="",h.textContent="";const n=I.value.trim();if(!n){m.textContent="Enter a peer name.";return}if(/\s/.test(n)){m.textContent="Peer name must not contain spaces.";return}x.disabled=!0,x.textContent="Creating\u2026";try{const i=await window.go.main.App.CreatePeer(n,$);I.value="",$="",S.textContent="Site folder: default (peers/<name>/site)",await _(i),h.textContent=`Created: ${i}`}catch(i){m.textContent=String(i)}finally{x.disabled=!1,x.textContent="Create"}}),G(),b(""),f&&f.length>0&&(b(f[0].name),G())}async function ce(){const e=document.querySelector(".brand-icon");e&&(e.src=ee),await ie();const t=await window.go.main.App.GetStatus();if(t&&t.started==="true"&&t.viewerURL){const c=t.rendezvousOnly==="true"?"/self":"/peers";await Q(t.viewerURL,c);return}const r=document.getElementById("content")||document.getElementById("app");!r||await de(r)}ce();
