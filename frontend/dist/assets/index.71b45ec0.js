(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))f(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&f(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function f(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();const Q="/assets/goop2-splash.8bd7ac35.png",X="/assets/goop2-icon.a8b5145f.png";function _(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Y(e,t){const r=document.createElement(e);return t&&(r.className=t),r}function o(e){return Y("div",e)}function N(e,t){const r=document.createElement("button");return r.type="button",r.className=t?`btn ${t}`:"btn",r.textContent=e,r}function Z(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function ee(e){const t=o("h1");return t.textContent=e,t}function G(e){const t=o("p");return t.textContent=e,t}function B(e){return e==="light"||e==="dark"?e:"dark"}function j(e){try{e=B(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function te(e){return String(e||"").replace(/\/+$/,"")}async function ne(){try{const e=await window.go.main.App.GetTheme();return B(e)}catch{return"dark"}}async function oe(e){e=B(e),j(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function re(){const e=document.getElementById("themeToggle");if(!e)return;const t=await ne();j(t),e.checked=t==="light",e.addEventListener("change",async()=>{const r=e.checked?"light":"dark";await oe(r)})}async function K(e,t){const r=te(e);if(!r)throw new Error("viewerURL is empty");const f=t&&String(t).startsWith("/")?t:"/peers",a=B(document.documentElement.getAttribute("data-theme"));let i="";try{i=await window.go.main.App.GetBridgeURL()}catch{i=""}const l=new URL(r+f);l.searchParams.set("theme",a),i&&l.searchParams.set("bridge",i),window.location.replace(l.toString())}function V(e,t){return e.find(r=>r.name===t)}function W(e,t){return e.some(r=>r.name===t)}async function ae(e){_(e),e.classList.add("launcher-host");const t=o("launcher"),r=o("launcher-splash"),f=document.createElement("img");f.src=Q,f.alt="Goop\xB2",r.appendChild(f),t.appendChild(r);const a=o("launcher-panel"),i=o("top");i.appendChild(ee("Goop\xB2 - Launcher")),i.appendChild(G("Pick a peer, or create a new one.")),a.appendChild(i);const l=o("card"),D=o("cardHead");D.appendChild(G("Create new peer")),l.appendChild(D);const T=o("cardBody"),U=o("row"),z=Z("Name your peer (no spaces or special characters)"),x=N("Create","secondary");U.appendChild(z),U.appendChild(x),T.appendChild(U);let I="";const $=o("row folderRow"),F=N("Browse\u2026","secondary"),S=o("folderLabel");S.textContent="Site folder: default (peers/<name>/site)",$.appendChild(F),$.appendChild(S),T.appendChild($),F.addEventListener("click",async()=>{try{const n=await window.go.main.App.SelectSiteFolder();n&&(I=n,S.textContent=n,S.title=n)}catch{}}),l.appendChild(T),a.appendChild(l);const A=o("card peersCard"),H=o("cardHead");H.appendChild(G("Peers")),A.appendChild(H);const q=o("cardBody"),P=o("tileList");q.appendChild(P),A.appendChild(q);const k=o("cardFoot"),p=N("Start","primary");p.disabled=!0;const w=N("Delete","danger");w.disabled=!0;const u=o("status"),h=o("error");k.appendChild(p),k.appendChild(w),k.appendChild(u),k.appendChild(h),A.appendChild(k),a.appendChild(A),t.appendChild(a),e.appendChild(t);let m=await window.go.main.App.ListPeers(),s="";function b(n){if(s=n,p.disabled=!s,w.disabled=!s,h.textContent="",s){const d=V(m,s);d&&d.rendezvous_only?(p.textContent="Configure",u.textContent=`Selected: ${s} (rendezvous)`):(p.textContent="Start",u.textContent=`Selected: ${s}`)}else p.textContent="Start",u.textContent=""}function O(){if(_(P),!m||m.length===0){const n=o("empty");n.textContent="No peers found.",P.appendChild(n),b("");return}for(const n of m){const d=o("tile"),v=o("tileLeft"),c=document.createElement("input");c.type="radio",c.name="peer",c.checked=n.name===s,c.addEventListener("change",()=>b(n.name));const L=o("tileMeta"),E=o("tileNameRow"),g=document.createElement("span");if(g.className="tileName",g.textContent=n.name,E.appendChild(g),n.rendezvous_only){const y=document.createElement("span");y.className="rv-badge",y.textContent="Rendezvous",E.appendChild(y)}const R=o("tilePath");R.textContent=`./peers/${n.name}/goop.json`,L.appendChild(E),L.appendChild(R),v.appendChild(c),v.appendChild(L),d.addEventListener("click",y=>{y.target!==c&&(c.checked=!0,b(n.name))}),d.appendChild(v),P.appendChild(d)}}async function M(n){m=await window.go.main.App.ListPeers(),n&&W(m,n)?b(n):W(m,s)||b(""),O()}p.addEventListener("click",async()=>{if(!s)return;const n=V(m,s),d=n&&n.rendezvous_only;p.disabled=!0,w.disabled=!0,h.textContent="",u.textContent=d?"Configuring\u2026":"Starting\u2026";const v=document.querySelector(".footer-inner"),c=o("progress-wrap"),L=o("progress-bar"),E=o("progress-fill");L.appendChild(E);const g=document.createElement("span");g.className="progress-label",g.textContent="Initializing\u2026",c.appendChild(L),c.appendChild(g),v&&v.appendChild(c);const R=C=>{if(!C)return;const J=Math.round(C.step/C.total*100);E.style.width=J+"%",g.textContent=C.label||""};window.runtime&&window.runtime.EventsOn("startup:progress",R);const y=()=>{window.runtime&&window.runtime.EventsOff("startup:progress"),c.parentNode&&c.remove()};try{await window.go.main.App.StartPeer(s);const C=await window.go.main.App.GetStatus();if(!C||!C.viewerURL)throw new Error("Started but viewerURL missing from status.");y(),await K(C.viewerURL,d?"/self":"/peers")}catch(C){y(),h.textContent=String(C),u.textContent="",p.disabled=!1,w.disabled=!1}}),w.addEventListener("click",async()=>{if(!(!s||!window.confirm(`Delete peer "${s}"?

This will remove ./peers/${s}/`))){h.textContent="",u.textContent="Deleting\u2026",p.disabled=!0,w.disabled=!0;try{await window.go.main.App.DeletePeer(s),await M(""),u.textContent="Deleted."}catch(d){h.textContent=String(d),u.textContent=""}finally{p.disabled=!s,w.disabled=!s}}}),x.addEventListener("click",async()=>{h.textContent="",u.textContent="";const n=z.value.trim();if(!n){h.textContent="Enter a peer name.";return}if(/\s/.test(n)){h.textContent="Peer name must not contain spaces.";return}x.disabled=!0,x.textContent="Creating\u2026";try{const d=await window.go.main.App.CreatePeer(n,I);z.value="",I="",S.textContent="Site folder: default (peers/<name>/site)",await M(d),u.textContent=`Created: ${d}`}catch(d){h.textContent=String(d)}finally{x.disabled=!1,x.textContent="Create"}}),O(),b(""),m&&m.length>0&&(b(m[0].name),O())}async function ie(){const e=document.querySelector(".brand-icon");e&&(e.src=X),await re();const t=await window.go.main.App.GetStatus();if(t&&t.started==="true"&&t.viewerURL){const f=t.rendezvousOnly==="true"?"/self":"/peers";await K(t.viewerURL,f);return}const r=document.getElementById("content")||document.getElementById("app");!r||await ae(r)}ie();
