(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))h(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();function D(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function O(e,t){const o=document.createElement(e);return t&&(o.className=t),o}function i(e){return O("div",e)}function P(e,t){const o=document.createElement("button");return o.type="button",o.className=t?`btn ${t}`:"btn",o.textContent=e,o}function z(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function F(e){const t=i("h1");return t.textContent=e,t}function T(e){const t=i("p");return t.textContent=e,t}function L(e){return e==="light"||e==="dark"?e:"dark"}function G(e){try{e=L(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function M(e){return String(e||"").replace(/\/+$/,"")}async function j(){try{const e=await window.go.main.App.GetTheme();return L(e)}catch{return"dark"}}async function q(e){e=L(e),G(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function K(){const e=document.getElementById("themeToggle");if(!e)return;const t=await j();G(t),e.checked=t==="light",e.addEventListener("change",async()=>{const o=e.checked?"light":"dark";await q(o)})}async function I(e,t){const o=M(e);if(!o)throw new Error("viewerURL is empty");const h=t&&String(t).startsWith("/")?t:"/peers",r=L(document.documentElement.getAttribute("data-theme"));let a="";try{a=await window.go.main.App.GetBridgeURL()}catch{a=""}const c=new URL(o+h);c.searchParams.set("theme",r),a&&c.searchParams.set("bridge",a),window.location.replace(c.toString())}async function V(e){D(e);const t=i("shell"),o=i("top");o.appendChild(F("Goop\xB2 - Launcher")),o.appendChild(T("Pick a peer, or create a new one.")),t.appendChild(o);const h=i("grid"),r=i("card"),a=i("cardHead");a.appendChild(T("Peers")),r.appendChild(a);const c=i("cardBody"),b=i("tileList");c.appendChild(b),r.appendChild(c);const y=i("cardFoot"),f=P("Start","primary");f.disabled=!0;const m=P("Delete","danger");m.disabled=!0;const l=i("status"),p=i("error");y.appendChild(f),y.appendChild(m),y.appendChild(l),y.appendChild(p),r.appendChild(y);const x=i("card"),B=i("cardHead");B.appendChild(T("Create new peer")),x.appendChild(B);const R=i("cardBody"),v=i("row"),E=z("peerC"),g=P("Create","secondary");v.appendChild(E),v.appendChild(g),R.appendChild(v),x.appendChild(R),h.appendChild(r),h.appendChild(x),t.appendChild(h),e.appendChild(t);let u=await window.go.main.App.ListPeers(),d="";function C(n){d=n,f.disabled=!d,m.disabled=!d,p.textContent="",l.textContent=d?`Selected: ${d}`:""}function S(){if(D(b),!u||u.length===0){const n=i("empty");n.textContent="No peers found.",b.appendChild(n),C("");return}for(const n of u){const s=i("tile"),k=i("tileLeft"),w=document.createElement("input");w.type="radio",w.name="peer",w.checked=n===d,w.addEventListener("change",()=>C(n));const A=i("tileMeta"),$=i("tileName");$.textContent=n;const N=i("tilePath");N.textContent=`./peers/${n}/goop.json`,A.appendChild($),A.appendChild(N),k.appendChild(w),k.appendChild(A),s.addEventListener("click",H=>{H.target!==w&&(w.checked=!0,C(n))}),s.appendChild(k),b.appendChild(s)}}async function U(n){u=await window.go.main.App.ListPeers(),n&&u.includes(n)?C(n):u.includes(d)||C(""),S()}f.addEventListener("click",async()=>{if(!!d){f.disabled=!0,m.disabled=!0,p.textContent="",l.textContent="Starting\u2026";try{await window.go.main.App.StartPeer(d);const n=await window.go.main.App.GetStatus();if(!n||!n.viewerURL)throw new Error("Started but viewerURL missing from status.");await I(n.viewerURL,"/peers")}catch(n){p.textContent=String(n),l.textContent="",f.disabled=!1,m.disabled=!1}}}),m.addEventListener("click",async()=>{if(!(!d||!window.confirm(`Delete peer "${d}"?

This will remove ./peers/${d}/`))){p.textContent="",l.textContent="Deleting\u2026",f.disabled=!0,m.disabled=!0;try{await window.go.main.App.DeletePeer(d),await U(""),l.textContent="Deleted."}catch(s){p.textContent=String(s),l.textContent=""}finally{f.disabled=!d,m.disabled=!d}}}),g.addEventListener("click",async()=>{p.textContent="",l.textContent="";const n=E.value.trim();if(!n){p.textContent="Enter a peer name.";return}g.disabled=!0,g.textContent="Creating\u2026";try{const s=await window.go.main.App.CreatePeer(n);E.value="",await U(s),l.textContent=`Created: ${s}`}catch(s){p.textContent=String(s)}finally{g.disabled=!1,g.textContent="Create"}}),S(),C(""),u&&u.length>0&&(C(u[0]),S())}async function W(){await K();const e=await window.go.main.App.GetStatus();if(e&&e.started==="true"&&e.viewerURL){await I(e.viewerURL,"/peers");return}const t=document.getElementById("content")||document.getElementById("app");!t||await V(t)}W();
