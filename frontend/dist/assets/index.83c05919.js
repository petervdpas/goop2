(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();function N(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function O(e,t){const o=document.createElement(e);return t&&(o.className=t),o}function i(e){return O("div",e)}function A(e,t){const o=document.createElement("button");return o.type="button",o.className=t?`btn ${t}`:"btn",o.textContent=e,o}function z(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function F(e){const t=i("h1");return t.textContent=e,t}function P(e){const t=i("p");return t.textContent=e,t}function b(e){return e==="light"||e==="dark"?e:"dark"}function M(){try{return b(localStorage.getItem("goop.theme"))}catch{return"dark"}}function D(e){try{e=b(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}async function j(){try{const e=await window.go.main.App.GetTheme();return b(e)}catch{return M()}}async function q(e){e=b(e),D(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function K(){const e=document.getElementById("themeToggle");if(!e)return;const t=await j();D(t),e.checked=t==="light",e.addEventListener("change",async()=>{const o=e.checked?"light":"dark";await q(o)})}function V(e){return String(e||"").replace(/\/+$/,"")}async function G(e,t){const o=V(e);if(!o)throw new Error("viewerURL is empty");const u=t&&String(t).startsWith("/")?t:"/peers",r=b(document.documentElement.getAttribute("data-theme"));let a="";try{a=await window.go.main.App.GetBridgeURL()}catch{a=""}const c=new URL(o+u);c.searchParams.set("theme",r),a&&c.searchParams.set("bridge",a),window.location.replace(c.toString())}async function W(e){N(e);const t=i("shell"),o=i("top");o.appendChild(F("Goop")),o.appendChild(P("Pick a peer, or create a new one.")),t.appendChild(o);const u=i("grid"),r=i("card"),a=i("cardHead");a.appendChild(P("Peers")),r.appendChild(a);const c=i("cardBody"),L=i("tileList");c.appendChild(L),r.appendChild(c);const y=i("cardFoot"),h=A("Start","primary");h.disabled=!0;const m=A("Delete","danger");m.disabled=!0;const l=i("status"),p=i("error");y.appendChild(h),y.appendChild(m),y.appendChild(l),y.appendChild(p),r.appendChild(y);const x=i("card"),T=i("cardHead");T.appendChild(P("Create new peer")),x.appendChild(T);const B=i("cardBody"),v=i("row"),E=z("peerC"),C=A("Create","secondary");v.appendChild(E),v.appendChild(C),B.appendChild(v),x.appendChild(B),u.appendChild(r),u.appendChild(x),t.appendChild(u),e.appendChild(t);let w=await window.go.main.App.ListPeers(),d="";function g(n){d=n,h.disabled=!d,m.disabled=!d,p.textContent="",l.textContent=d?`Selected: ${d}`:""}function R(){if(N(L),!w||w.length===0){const n=i("empty");n.textContent="No peers found.",L.appendChild(n),g("");return}for(const n of w){const s=i("tile"),S=i("tileLeft"),f=document.createElement("input");f.type="radio",f.name="peer",f.checked=n===d,f.addEventListener("change",()=>g(n));const k=i("tileMeta"),$=i("tileName");$.textContent=n;const I=i("tilePath");I.textContent=`./peers/${n}/goop.json`,k.appendChild($),k.appendChild(I),S.appendChild(f),S.appendChild(k),s.addEventListener("click",H=>{H.target!==f&&(f.checked=!0,g(n))}),s.appendChild(S),L.appendChild(s)}}async function U(n){w=await window.go.main.App.ListPeers(),n&&w.includes(n)?g(n):w.includes(d)||g(""),R()}h.addEventListener("click",async()=>{if(!!d){h.disabled=!0,m.disabled=!0,p.textContent="",l.textContent="Starting\u2026";try{await window.go.main.App.StartPeer(d);const n=await window.go.main.App.GetStatus();if(!n||!n.viewerURL)throw new Error("Started but viewerURL missing from status.");await G(n.viewerURL,"/peers")}catch(n){p.textContent=String(n),l.textContent="",h.disabled=!1,m.disabled=!1}}}),m.addEventListener("click",async()=>{if(!(!d||!window.confirm(`Delete peer "${d}"?

This will remove ./peers/${d}/`))){p.textContent="",l.textContent="Deleting\u2026",h.disabled=!0,m.disabled=!0;try{await window.go.main.App.DeletePeer(d),await U(""),l.textContent="Deleted."}catch(s){p.textContent=String(s),l.textContent=""}finally{h.disabled=!d,m.disabled=!d}}}),C.addEventListener("click",async()=>{p.textContent="",l.textContent="";const n=E.value.trim();if(!n){p.textContent="Enter a peer name.";return}C.disabled=!0,C.textContent="Creating\u2026";try{const s=await window.go.main.App.CreatePeer(n);E.value="",await U(s),l.textContent=`Created: ${s}`}catch(s){p.textContent=String(s)}finally{C.disabled=!1,C.textContent="Create"}}),R(),g("")}async function J(){await K();const e=await window.go.main.App.GetStatus();if(e&&e.started==="true"&&e.viewerURL){await G(e.viewerURL,"/peers");return}const t=document.getElementById("content")||document.getElementById("app");!t||await W(t)}J();
