(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))h(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const M="/assets/goop2-splash.8bd7ac35.png",V="/assets/goop2.504b799b.png";function O(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function j(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function a(e){return j("div",e)}function U(e,t){const n=document.createElement("button");return n.type="button",n.className=t?`btn ${t}`:"btn",n.textContent=e,n}function K(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function W(e){const t=a("h1");return t.textContent=e,t}function B(e){const t=a("p");return t.textContent=e,t}function E(e){return e==="light"||e==="dark"?e:"dark"}function q(e){try{e=E(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function J(e){return String(e||"").replace(/\/+$/,"")}async function Q(){try{const e=await window.go.main.App.GetTheme();return E(e)}catch{return"dark"}}async function X(e){e=E(e),q(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function Y(){const e=document.getElementById("themeToggle");if(!e)return;const t=await Q();q(t),e.checked=t==="light",e.addEventListener("change",async()=>{const n=e.checked?"light":"dark";await X(n)})}async function F(e,t){const n=J(e);if(!n)throw new Error("viewerURL is empty");const h=t&&String(t).startsWith("/")?t:"/peers",o=E(document.documentElement.getAttribute("data-theme"));let i="";try{i=await window.go.main.App.GetBridgeURL()}catch{i=""}const c=new URL(n+h);c.searchParams.set("theme",o),i&&c.searchParams.set("bridge",i),window.location.replace(c.toString())}function H(e,t){return e.find(n=>n.name===t)}function _(e,t){return e.some(n=>n.name===t)}async function Z(e){O(e),e.classList.add("launcher-host");const t=a("launcher"),n=a("launcher-splash"),h=document.createElement("img");h.src=M,h.alt="Goop\xB2",n.appendChild(h),t.appendChild(n);const o=a("launcher-panel"),i=a("top");i.appendChild(W("Goop\xB2 - Launcher")),i.appendChild(B("Pick a peer, or create a new one.")),o.appendChild(i);const c=a("card"),N=a("cardHead");N.appendChild(B("Create new peer")),c.appendChild(N);const z=a("cardBody"),S=a("row"),k=K("peerC"),y=U("Create","secondary");S.appendChild(k),S.appendChild(y),z.appendChild(S),c.appendChild(z),o.appendChild(c);const v=a("card peersCard"),$=a("cardHead");$.appendChild(B("Peers")),v.appendChild($);const G=a("cardBody"),L=a("tileList");G.appendChild(L),v.appendChild(G);const b=a("cardFoot"),l=U("Start","primary");l.disabled=!0;const C=U("Delete","danger");C.disabled=!0;const p=a("status"),m=a("error");b.appendChild(l),b.appendChild(C),b.appendChild(p),b.appendChild(m),v.appendChild(b),o.appendChild(v),t.appendChild(o),e.appendChild(t);let u=await window.go.main.App.ListPeers(),d="";function g(r){if(d=r,l.disabled=!d,C.disabled=!d,m.textContent="",d){const s=H(u,d);s&&s.rendezvous_only?(l.textContent="Configure",p.textContent=`Selected: ${d} (rendezvous)`):(l.textContent="Start",p.textContent=`Selected: ${d}`)}else l.textContent="Start",p.textContent=""}function A(){if(O(L),!u||u.length===0){const r=a("empty");r.textContent="No peers found.",L.appendChild(r),g("");return}for(const r of u){const s=a("tile"),f=a("tileLeft"),w=document.createElement("input");w.type="radio",w.name="peer",w.checked=r.name===d,w.addEventListener("change",()=>g(r.name));const P=a("tileMeta"),R=a("tileNameRow"),T=document.createElement("span");if(T.className="tileName",T.textContent=r.name,R.appendChild(T),r.rendezvous_only){const x=document.createElement("span");x.className="rv-badge",x.textContent="Rendezvous",R.appendChild(x)}const D=a("tilePath");D.textContent=`./peers/${r.name}/goop.json`,P.appendChild(R),P.appendChild(D),f.appendChild(w),f.appendChild(P),s.addEventListener("click",x=>{x.target!==w&&(w.checked=!0,g(r.name))}),s.appendChild(f),L.appendChild(s)}}async function I(r){u=await window.go.main.App.ListPeers(),r&&_(u,r)?g(r):_(u,d)||g(""),A()}l.addEventListener("click",async()=>{if(!d)return;const r=H(u,d),s=r&&r.rendezvous_only;l.disabled=!0,C.disabled=!0,m.textContent="",p.textContent=s?"Configuring\u2026":"Starting\u2026";try{await window.go.main.App.StartPeer(d);const f=await window.go.main.App.GetStatus();if(!f||!f.viewerURL)throw new Error("Started but viewerURL missing from status.");await F(f.viewerURL,s?"/self":"/peers")}catch(f){m.textContent=String(f),p.textContent="",l.disabled=!1,C.disabled=!1}}),C.addEventListener("click",async()=>{if(!(!d||!window.confirm(`Delete peer "${d}"?

This will remove ./peers/${d}/`))){m.textContent="",p.textContent="Deleting\u2026",l.disabled=!0,C.disabled=!0;try{await window.go.main.App.DeletePeer(d),await I(""),p.textContent="Deleted."}catch(s){m.textContent=String(s),p.textContent=""}finally{l.disabled=!d,C.disabled=!d}}}),y.addEventListener("click",async()=>{m.textContent="",p.textContent="";const r=k.value.trim();if(!r){m.textContent="Enter a peer name.";return}y.disabled=!0,y.textContent="Creating\u2026";try{const s=await window.go.main.App.CreatePeer(r);k.value="",await I(s),p.textContent=`Created: ${s}`}catch(s){m.textContent=String(s)}finally{y.disabled=!1,y.textContent="Create"}}),A(),g(""),u&&u.length>0&&(g(u[0].name),A())}async function ee(){const e=document.querySelector(".brand-icon");e&&(e.src=V),await Y();const t=await window.go.main.App.GetStatus();if(t&&t.started==="true"&&t.viewerURL){const h=t.rendezvousOnly==="true"?"/self":"/peers";await F(t.viewerURL,h);return}const n=document.getElementById("content")||document.getElementById("app");!n||await Z(n)}ee();
