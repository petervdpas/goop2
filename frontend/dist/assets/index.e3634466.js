(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))m(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&m(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function m(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const M="/assets/goop2-splash.8bd7ac35.png",V="/assets/goop2-icon.a8b5145f.png";function O(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function j(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function o(e){return j("div",e)}function N(e,t){const n=document.createElement("button");return n.type="button",n.className=t?`btn ${t}`:"btn",n.textContent=e,n}function K(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function W(e){const t=o("h1");return t.textContent=e,t}function U(e){const t=o("p");return t.textContent=e,t}function E(e){return e==="light"||e==="dark"?e:"dark"}function q(e){try{e=E(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function J(e){return String(e||"").replace(/\/+$/,"")}async function Q(){try{const e=await window.go.main.App.GetTheme();return E(e)}catch{return"dark"}}async function X(e){e=E(e),q(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function Y(){const e=document.getElementById("themeToggle");if(!e)return;const t=await Q();q(t),e.checked=t==="light",e.addEventListener("change",async()=>{const n=e.checked?"light":"dark";await X(n)})}async function F(e,t){const n=J(e);if(!n)throw new Error("viewerURL is empty");const m=t&&String(t).startsWith("/")?t:"/peers",r=E(document.documentElement.getAttribute("data-theme"));let i="";try{i=await window.go.main.App.GetBridgeURL()}catch{i=""}const d=new URL(n+m);d.searchParams.set("theme",r),i&&d.searchParams.set("bridge",i),window.location.replace(d.toString())}function H(e,t){return e.find(n=>n.name===t)}function _(e,t){return e.some(n=>n.name===t)}async function Z(e){O(e),e.classList.add("launcher-host");const t=o("launcher"),n=o("launcher-splash"),m=document.createElement("img");m.src=M,m.alt="Goop\xB2",n.appendChild(m),t.appendChild(n);const r=o("launcher-panel"),i=o("top");i.appendChild(W("Goop\xB2 - Launcher")),i.appendChild(U("Pick a peer, or create a new one.")),r.appendChild(i);const d=o("card"),B=o("cardHead");B.appendChild(U("Create new peer")),d.appendChild(B);const z=o("cardBody"),S=o("row"),k=K("Name your peer (no spaces or special characters)"),y=N("Create","secondary");S.appendChild(k),S.appendChild(y),z.appendChild(S),d.appendChild(z),r.appendChild(d);const v=o("card peersCard"),$=o("cardHead");$.appendChild(U("Peers")),v.appendChild($);const G=o("cardBody"),L=o("tileList");G.appendChild(L),v.appendChild(G);const b=o("cardFoot"),l=N("Start","primary");l.disabled=!0;const C=N("Delete","danger");C.disabled=!0;const p=o("status"),h=o("error");b.appendChild(l),b.appendChild(C),b.appendChild(p),b.appendChild(h),v.appendChild(b),r.appendChild(v),t.appendChild(r),e.appendChild(t);let u=await window.go.main.App.ListPeers(),s="";function g(a){if(s=a,l.disabled=!s,C.disabled=!s,h.textContent="",s){const c=H(u,s);c&&c.rendezvous_only?(l.textContent="Configure",p.textContent=`Selected: ${s} (rendezvous)`):(l.textContent="Start",p.textContent=`Selected: ${s}`)}else l.textContent="Start",p.textContent=""}function A(){if(O(L),!u||u.length===0){const a=o("empty");a.textContent="No peers found.",L.appendChild(a),g("");return}for(const a of u){const c=o("tile"),f=o("tileLeft"),w=document.createElement("input");w.type="radio",w.name="peer",w.checked=a.name===s,w.addEventListener("change",()=>g(a.name));const P=o("tileMeta"),R=o("tileNameRow"),T=document.createElement("span");if(T.className="tileName",T.textContent=a.name,R.appendChild(T),a.rendezvous_only){const x=document.createElement("span");x.className="rv-badge",x.textContent="Rendezvous",R.appendChild(x)}const D=o("tilePath");D.textContent=`./peers/${a.name}/goop.json`,P.appendChild(R),P.appendChild(D),f.appendChild(w),f.appendChild(P),c.addEventListener("click",x=>{x.target!==w&&(w.checked=!0,g(a.name))}),c.appendChild(f),L.appendChild(c)}}async function I(a){u=await window.go.main.App.ListPeers(),a&&_(u,a)?g(a):_(u,s)||g(""),A()}l.addEventListener("click",async()=>{if(!s)return;const a=H(u,s),c=a&&a.rendezvous_only;l.disabled=!0,C.disabled=!0,h.textContent="",p.textContent=c?"Configuring\u2026":"Starting\u2026";try{await window.go.main.App.StartPeer(s);const f=await window.go.main.App.GetStatus();if(!f||!f.viewerURL)throw new Error("Started but viewerURL missing from status.");await F(f.viewerURL,c?"/self":"/peers")}catch(f){h.textContent=String(f),p.textContent="",l.disabled=!1,C.disabled=!1}}),C.addEventListener("click",async()=>{if(!(!s||!window.confirm(`Delete peer "${s}"?

This will remove ./peers/${s}/`))){h.textContent="",p.textContent="Deleting\u2026",l.disabled=!0,C.disabled=!0;try{await window.go.main.App.DeletePeer(s),await I(""),p.textContent="Deleted."}catch(c){h.textContent=String(c),p.textContent=""}finally{l.disabled=!s,C.disabled=!s}}}),y.addEventListener("click",async()=>{h.textContent="",p.textContent="";const a=k.value.trim();if(!a){h.textContent="Enter a peer name.";return}if(/\s/.test(a)){h.textContent="Peer name must not contain spaces.";return}y.disabled=!0,y.textContent="Creating\u2026";try{const c=await window.go.main.App.CreatePeer(a);k.value="",await I(c),p.textContent=`Created: ${c}`}catch(c){h.textContent=String(c)}finally{y.disabled=!1,y.textContent="Create"}}),A(),g(""),u&&u.length>0&&(g(u[0].name),A())}async function ee(){const e=document.querySelector(".brand-icon");e&&(e.src=V),await Y();const t=await window.go.main.App.GetStatus();if(t&&t.started==="true"&&t.viewerURL){const m=t.rendezvousOnly==="true"?"/self":"/peers";await F(t.viewerURL,m);return}const n=document.getElementById("content")||document.getElementById("app");!n||await Z(n)}ee();
