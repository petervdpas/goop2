(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))C(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&C(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function C(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();const ee="/assets/goop2-splash.8bd7ac35.png",U="/assets/goop2-splash2.a0bd093f.png",te="/assets/goop2-splash3.68442960.png",ne="/assets/goop2-icon.a8b5145f.png";function j(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function oe(e,t){const r=document.createElement(e);return t&&(r.className=t),r}function n(e){return oe("div",e)}function N(e,t){const r=document.createElement("button");return r.type="button",r.className=t?`btn ${t}`:"btn",r.textContent=e,r}function re(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function ae(e){const t=n("h1");return t.textContent=e,t}function H(e){const t=n("p");return t.textContent=e,t}function B(e){return e==="light"||e==="dark"?e:"dark"}function X(e){try{e=B(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function se(e){return String(e||"").replace(/\/+$/,"")}const K={"goop2-splash.png":ee,"goop2-splash2.png":U,"goop2-splash3.png":te};async function ie(){try{const e=await window.go.main.App.GetTheme();return B(e)}catch{return"dark"}}async function de(e){e=B(e),X(e);try{await window.go.main.App.SetTheme(e)}catch{}}async function ce(){const e=document.getElementById("themeToggle");if(!e)return;const t=await ie();X(t),e.checked=t==="light",e.addEventListener("change",async()=>{const r=e.checked?"light":"dark";await de(r)})}async function Y(e,t){const r=se(e);if(!r)throw new Error("viewerURL is empty");const C=t&&String(t).startsWith("/")?t:"/peers",a=B(document.documentElement.getAttribute("data-theme"));let i="";try{i=await window.go.main.App.GetBridgeURL()}catch{i=""}const l=new URL(r+C);l.searchParams.set("theme",a),i&&l.searchParams.set("bridge",i),window.location.replace(l.toString())}function J(e,t){if(!(!e||!Array.isArray(e)))return e.find(r=>r.name===t)}function Q(e,t){return!e||!Array.isArray(e)?!1:e.some(r=>r.name===t)}async function le(e){j(e),e.classList.add("launcher-host");const t=n("launcher"),r=n("splash-col"),C=n("splash-img-wrap"),a=document.createElement("img");a.src=U,a.alt="Goop\xB2",C.appendChild(a),r.appendChild(C),t.appendChild(r);const i=n("panel-col"),l=n("panel-col-content"),T=n("top");T.appendChild(ae("Goop\xB2 - Launcher")),T.appendChild(H("Pick a peer, or create a new one.")),l.appendChild(T);const z=n("card"),M=n("cardHead");M.appendChild(H("Create new peer")),z.appendChild(M);const I=n("cardBody"),$=n("row"),O=re("Name your peer (no spaces or special characters)"),x=N("Create","secondary");$.appendChild(O),$.appendChild(x),I.appendChild($);let G="";const D=n("row folderRow"),q=N("Browse\u2026","secondary"),S=n("folderLabel");S.textContent="Site folder: default (peers/<name>/site)",D.appendChild(q),D.appendChild(S),I.appendChild(D),q.addEventListener("click",async()=>{try{const o=await window.go.main.App.SelectSiteFolder();o&&(G=o,S.textContent=o,S.title=o)}catch{}}),z.appendChild(I),l.appendChild(z);const k=n("card peersCard"),W=n("cardHead");W.appendChild(H("Peers")),k.appendChild(W);const _=n("cardBody"),P=n("tileList");_.appendChild(P),k.appendChild(_);const A=n("cardFoot"),p=N("Start","primary");p.disabled=!0;const g=N("Delete","danger");g.disabled=!0;const u=n("status"),f=n("error");A.appendChild(p),A.appendChild(g),A.appendChild(u),A.appendChild(f),k.appendChild(A),l.appendChild(k),i.appendChild(l),t.appendChild(i),e.appendChild(t);let h=await window.go.main.App.ListPeers(),d="";function b(o){if(d=o,p.disabled=!d,g.disabled=!d,f.textContent="",d){const s=J(h,d);s&&s.rendezvous_only?(p.textContent="Configure",u.textContent=`Selected: ${d} (rendezvous)`):(p.textContent="Start",u.textContent=`Selected: ${d}`),s&&s.splash&&K[s.splash]?a.src=K[s.splash]:a.src=U}else p.textContent="Start",u.textContent="",a.src=U}function F(){if(j(P),!h||h.length===0){const o=n("empty");o.textContent="No peers found.",P.appendChild(o),b("");return}for(const o of h){const s=n("tile"),v=n("tileLeft"),c=document.createElement("input");c.type="radio",c.name="peer",c.checked=o.name===d,c.addEventListener("change",()=>b(o.name));const L=n("tileMeta"),E=n("tileNameRow"),w=document.createElement("span");if(w.className="tileName",w.textContent=o.name,E.appendChild(w),o.rendezvous_only){const y=document.createElement("span");y.className="rv-badge",y.textContent="Rendezvous",E.appendChild(y)}const R=n("tilePath");R.textContent=`./peers/${o.name}/goop.json`,L.appendChild(E),L.appendChild(R),v.appendChild(c),v.appendChild(L),s.addEventListener("click",y=>{y.target!==c&&(c.checked=!0,b(o.name))}),s.appendChild(v),P.appendChild(s)}}async function V(o){h=await window.go.main.App.ListPeers(),o&&Q(h,o)?b(o):Q(h,d)||b(""),F()}p.addEventListener("click",async()=>{if(!d)return;const o=J(h,d),s=o&&o.rendezvous_only;p.disabled=!0,g.disabled=!0,f.textContent="",u.textContent=s?"Configuring\u2026":"Starting\u2026";const v=document.querySelector(".footer-inner"),c=n("progress-wrap"),L=n("progress-bar"),E=n("progress-fill");L.appendChild(E);const w=document.createElement("span");w.className="progress-label",w.textContent="Initializing\u2026",c.appendChild(L),c.appendChild(w),v&&v.appendChild(c);const R=m=>{if(!m)return;const Z=Math.round(m.step/m.total*100);E.style.width=Z+"%",w.textContent=m.label||""};window.runtime&&window.runtime.EventsOn("startup:progress",R);const y=()=>{window.runtime&&window.runtime.EventsOff("startup:progress"),c.parentNode&&c.remove()};try{await window.go.main.App.StartPeer(d);const m=await window.go.main.App.GetStatus();if(!m||!m.viewerURL)throw new Error("Started but viewerURL missing from status.");y(),await Y(m.viewerURL,s?"/self":"/peers")}catch(m){y(),f.textContent=String(m),u.textContent="",p.disabled=!1,g.disabled=!1}}),g.addEventListener("click",async()=>{if(!(!d||!window.confirm(`Delete peer "${d}"?

This will remove ./peers/${d}/`))){f.textContent="",u.textContent="Deleting\u2026",p.disabled=!0,g.disabled=!0;try{await window.go.main.App.DeletePeer(d),await V(""),u.textContent="Deleted."}catch(s){f.textContent=String(s),u.textContent=""}finally{p.disabled=!d,g.disabled=!d}}}),x.addEventListener("click",async()=>{f.textContent="",u.textContent="";const o=O.value.trim();if(!o){f.textContent="Enter a peer name.";return}if(/\s/.test(o)){f.textContent="Peer name must not contain spaces.";return}x.disabled=!0,x.textContent="Creating\u2026";try{const s=await window.go.main.App.CreatePeer(o,G);O.value="",G="",S.textContent="Site folder: default (peers/<name>/site)",await V(s),u.textContent=`Created: ${s}`}catch(s){f.textContent=String(s)}finally{x.disabled=!1,x.textContent="Create"}}),F(),b(""),h&&h.length>0&&(b(h[0].name),F())}async function pe(){const e=document.querySelector(".brand-icon");e&&(e.src=ne),await ce();const t=await window.go.main.App.GetStatus();if(t&&t.started==="true"&&t.viewerURL){const C=t.rendezvousOnly==="true"?"/self":"/peers";await Y(t.viewerURL,C);return}const r=document.getElementById("content")||document.getElementById("app");!r||await le(r)}pe();
