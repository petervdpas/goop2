(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function i(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerpolicy&&(d.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?d.credentials="include":o.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function p(o){if(o.ep)return;o.ep=!0;const d=i(o);fetch(o.href,d)}})();function R(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function O(e,t){const i=document.createElement(e);return t&&(i.className=t),i}function r(e){return O("div",e)}function S(e,t){const i=document.createElement("button");return i.type="button",i.className=t?`btn ${t}`:"btn",i.textContent=e,i}function G(e){const t=document.createElement("input");return t.type="text",t.className="input",t.placeholder=e,t.autocomplete="off",t.spellcheck=!1,t}function F(e){const t=r("h1");return t.textContent=e,t}function A(e){const t=r("p");return t.textContent=e,t}function M(){try{let e=localStorage.getItem("goop.theme");return e!=="light"&&e!=="dark"&&(e="dark"),e}catch{return"dark"}}function U(e){try{e!=="light"&&e!=="dark"&&(e="dark"),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("goop.theme",e)}catch{}}function j(){const e=document.getElementById("themeToggle");!e||(U(M()),e.checked=(document.documentElement.getAttribute("data-theme")||"dark")==="light",e.addEventListener("change",()=>{const t=document.documentElement.getAttribute("data-theme")||"dark";U(t==="dark"?"light":"dark"),e.checked=(document.documentElement.getAttribute("data-theme")||"dark")==="light"}))}function q(e){return String(e||"").replace(/\/+$/,"")}function D(e,t){const i=q(e);if(!i)throw new Error("viewerURL is empty");const p=t&&String(t).startsWith("/")?t:"/peers";window.location.replace(i+p)}async function z(e){R(e);const t=r("shell"),i=r("top");i.appendChild(F("Goop")),i.appendChild(A("Pick a peer, or create a new one.")),t.appendChild(i);const p=r("grid"),o=r("card"),d=r("cardHead");d.appendChild(A("Peers")),o.appendChild(d);const m=r("cardBody"),b=r("tileList");m.appendChild(b),o.appendChild(m);const y=r("cardFoot"),u=S("Start","primary");u.disabled=!0;const h=S("Delete","danger");h.disabled=!0;const s=r("status"),l=r("error");y.appendChild(u),y.appendChild(h),y.appendChild(s),y.appendChild(l),o.appendChild(y);const x=r("card"),P=r("cardHead");P.appendChild(A("Create new peer")),x.appendChild(P);const B=r("cardBody"),L=r("row"),k=G("peerC"),C=S("Create","secondary");L.appendChild(k),L.appendChild(C),B.appendChild(L),x.appendChild(B),p.appendChild(o),p.appendChild(x),t.appendChild(p),e.appendChild(t);let g=await window.go.main.App.ListPeers(),a="";function w(n){a=n,u.disabled=!a,h.disabled=!a,l.textContent="",s.textContent=a?`Selected: ${a}`:""}function T(){if(R(b),!g||g.length===0){const n=r("empty");n.textContent="No peers found.",b.appendChild(n),w("");return}for(const n of g){const c=r("tile"),v=r("tileLeft"),f=document.createElement("input");f.type="radio",f.name="peer",f.checked=n===a,f.addEventListener("change",()=>w(n));const E=r("tileMeta"),I=r("tileName");I.textContent=n;const N=r("tilePath");N.textContent=`./peers/${n}/goop.json`,E.appendChild(I),E.appendChild(N),v.appendChild(f),v.appendChild(E),c.addEventListener("click",H=>{H.target!==f&&(f.checked=!0,w(n))}),c.appendChild(v),b.appendChild(c)}}async function $(n){g=await window.go.main.App.ListPeers(),n&&g.includes(n)?w(n):g.includes(a)||w(""),T()}u.addEventListener("click",async()=>{if(!!a){u.disabled=!0,h.disabled=!0,l.textContent="",s.textContent="Starting\u2026";try{await window.go.main.App.StartPeer(a);const n=await window.go.main.App.GetStatus();if(!n||!n.viewerURL)throw new Error("Started but viewerURL missing from status.");D(n.viewerURL,"/peers")}catch(n){l.textContent=String(n),s.textContent="",u.disabled=!1,h.disabled=!1}}}),h.addEventListener("click",async()=>{if(!(!a||!window.confirm(`Delete peer "${a}"?

This will remove ./peers/${a}/`))){l.textContent="",s.textContent="Deleting\u2026",u.disabled=!0,h.disabled=!0;try{await window.go.main.App.DeletePeer(a),await $(""),s.textContent="Deleted."}catch(c){l.textContent=String(c),s.textContent=""}finally{u.disabled=!a,h.disabled=!a}}}),C.addEventListener("click",async()=>{l.textContent="",s.textContent="";const n=k.value.trim();if(!n){l.textContent="Enter a peer name.";return}C.disabled=!0,C.textContent="Creating\u2026";try{const c=await window.go.main.App.CreatePeer(n);k.value="",await $(c),s.textContent=`Created: ${c}`}catch(c){l.textContent=String(c)}finally{C.disabled=!1,C.textContent="Create"}}),T(),w("")}async function K(){j();const e=await window.go.main.App.GetStatus();if(e&&e.started==="true"&&e.viewerURL){D(e.viewerURL,"/peers");return}const t=document.getElementById("content")||document.getElementById("app");!t||await z(t)}K();
